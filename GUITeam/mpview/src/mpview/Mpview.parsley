import mpview.MpviewSaveableTreeFormView
import org.eclipse.emf.common.util.URI
import java.util.ArrayList
import org.palladiosimulator.monitorrepository.MonitorRepositoryFactory
import org.palladiosimulator.edp2.models.measuringpoint.MeasuringPoint
import org.palladiosimulator.monitorrepository.Monitor
import org.palladiosimulator.monitorrepository.MeasurementSpecification
import org.palladiosimulator.monitorrepository.MonitorRepository

/* mpview EMF Parsley Dsl Module file */
module mpview {
	
	parts {
		viewpart mpview {
			viewname "Measuringpoint View"
			viewclass MpviewSaveableTreeFormView
		}
	}
	
	configurator {
		resourceURI {
			MpviewSaveableTreeFormView -> {
				//TODO Eigener Monitorrepositorypfad angegeben. Der Pfad wird sp�ter im E4 Plugin extra gesetzt und ist nur f�r einfachen Parsley "Measuringpoint View" notwendig.
				return URI.createFileURI("/Users/zss2/runtime-EclipseApplication/Pets.com/PetsMonitor.monitorrepository")
			}
		}
	}
	
	resourceManager {
		initializeResource {
			// Optional: initialize an empty Resource
			// 'it' is of type Resource
			// e.g., it.getContents += myFactory.createMyClass
			it.getContents += MonitorRepositoryFactory.eINSTANCE
		}
		
		saveResource {
			it.save(null)
			return true
		}
		
	}
	
	viewerContentProvider {
		children {
			 Monitor mon-> {
			 	//Ein Monitor hat einen MeasuringPoint und seine MeasurementSpecifications als Kindknoten. 
			 	//Da der MeasuringPoint im EMF- Modell nur ein Attribut von einem Monitor ist, gibt es sp�ter Probleme, wenn man einen MeasuringPoint
			 	//�ber den TreeView bearbeitet. (Drag and Drop oder MeasuringPoint l�schen)
				new ArrayList()=>[
						add(mon.measuringPoint)
						addAll(mon.measurementSpecifications)
					]
			}
		}
	} 
	
	
	labelProvider {
		text {
			Monitor mon-> {
				mon.entityName
			}
			
			MeasuringPoint mp -> {
				mp.stringRepresentation
			}
			
			MeasurementSpecification ms -> {
				ms.name
			}
		}
		
		image {
			Monitor mon-> 
				if (mon.activated) {
					"ActiveIcon.png"
				} else {
					"InactiveIcon.png"
				}
			MeasurementSpecification ms ->
				if (ms.isTriggersSelfAdaptations)
					"self_adaption.png"
				else
					"nonself_adaption.png"
			
		}
	}
	
	//Hier m�ssen noch weitere Menupunkte spezifisch f�r das Selektierte Item angeboten werden.
	menuBuilder {
		menus {
			MonitorRepository mr -> #[
				
				actionChange("Add new Measuringpoint",mr,
					[
						System.out.println("Hier kommt die Wizard anbindung");
					]
				)
				
			]
		}
	}
}
